<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Contact</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
:root {
    --sage-bg: #9CAF88;
    --sage-darker: #7D9B6F;
    --sage-hover: #8FAE79;
    --sage-active: #9ACF90;
}

* {
    box-sizing: border-box;
}

body {
    font-family: 'Baloo 2', sans-serif;
    background-color: var(--sage-bg);
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    margin: 0;
    padding: 20px 15px;
    font-weight: 500;
}

.container {
    background-color: #FFF9E3;
    padding: 35px 30px;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    width: 100%;
    max-width: 500px;
    transition: transform 0.3s ease;
}

.container:hover {
    transform: translateY(-3px);
}

h1 {
    text-align: center;
    margin-bottom: 25px;
    color: var(--sage-darker);
    font-weight: 700;
    font-size: 1.8em;
}

label {
    font-weight: 600;
    margin-top: 10px;
    display: block;
    font-size: 14px;
}

input, textarea {
    width: 100%;
    padding: 12px;
    margin: 6px 0 16px 0;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 16px;
    box-sizing: border-box;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    font-family: 'Baloo 2', sans-serif;
}

input:focus, textarea:focus {
    border-color: var(--sage-darker);
    box-shadow: 0 0 8px rgba(125,155,111,0.2);
    outline: none;
}

button[type="submit"] {
    width: 100%;
    padding: 14px;
    background-color: #7B9A6D;
    color: #FFFFFF;
    font-size: 16px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 600;
    margin-top: 10px;
}

button[type="submit"]:hover {
    background-color: var(--sage-hover);
}

button[type="submit"].valid {
    background-color: var(--sage-hover);
}

button[type="submit"].valid:active {
    background-color: var(--sage-active);
}

.toggle-text {
    color: var(--sage-darker);
    font-weight: 600;
    cursor: pointer;
    margin-bottom: 12px;
    font-size: 14px;
    text-align: left;
}

.toggle-text:hover {
    text-decoration: underline;
}

.optional-fields {
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 15px;
    border: 2px solid var(--sage-darker);
}

#qr-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin-top: 30px;
    padding: 20px;
    background-color: #FFF9E3;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    width: 100%;
}

#qr-section h2 {
    color: var(--sage-darker);
    margin-bottom: 12px;
    font-size: 1.4em;
}

#qr-section img {
    max-width: 100%;
    width: 280px;
    height: auto;
    margin-bottom: 12px;
}

#qr-section a {
    margin-top: 12px;
    width: 100%;
    display: flex;
    justify-content: center;
    text-decoration: none;
}

#qr-section a button {
    padding: 12px 20px;
    background-color: #7B9A6D;
    color: #FFFFFF;
    font-size: 15px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 600;
}

#qr-section a button:hover {
    background-color: var(--sage-hover);
    transform: translateY(-2px);
}

.optional {
    font-size: 0.85em;
    color: #888;
}

.error {
    color: red;
    font-weight: 600;
    margin-bottom: 15px;
    text-align: center;
}

/* Mobile optimizations */
@media (max-width: 600px) {
    body {
        padding: 10px;
        align-items: flex-start;
    }
    
    .container {
        padding: 25px 20px;
        margin: 0;
        border-radius: 15px;
        min-height: calc(100vh - 20px);
    }
    
    h1 {
        font-size: 1.6em;
        margin-bottom: 20px;
    }
    
    label {
        font-size: 15px;
    }
    
    input, textarea {
        font-size: 16px;
        padding: 14px;
    }
    
    button[type="submit"] {
        padding: 16px;
        font-size: 17px;
    }
    
    #qr-section {
        padding: 15px;
    }
    
    #qr-section img {
        width: 100%;
        max-width: 300px;
    }
    
    #qr-section a button {
        width: 100%;
        padding: 14px;
        font-size: 16px;
    }
}

@media (max-width: 380px) {
    .container {
        padding: 20px 15px;
    }
    
    h1 {
        font-size: 1.4em;
    }
}
</style>
</head>
<body>

<div class="container">
    <h1>Quick Contact</h1>

    {% if error_message %}
        <div class="error">{{ error_message }}</div>
    {% endif %}

    <form method="POST" id="contactForm">
        <label for="name">Full Name:</label>
        <input type="text" name="name" id="name" required value="{{ values.get('name','') }}" autocomplete="name">

        <label for="phone">Phone Number:</label>
        <input type="tel" name="phone" id="phone" required value="{{ values.get('phone','') }}" autocomplete="tel">

        <label for="email">Email: <span class="optional">(optional)</span></label>
        <input type="email" name="email" id="email" value="{{ values.get('email','') }}" autocomplete="email">

        <div id="toggleOptional" class="toggle-text">Show More Optional Fields ▼</div>

        <div class="optional-fields" id="optionalFields" style="display:none;">
            <label for="org">Organization:</label>
            <input type="text" name="org" id="org" value="{{ values.get('org','') }}" autocomplete="organization">

            <label for="title">Job Title:</label>
            <input type="text" name="title" id="title" value="{{ values.get('title','') }}" autocomplete="organization-title">

            <label for="birthday">Birthday:</label>
            <input type="text" id="birthday" name="birthday" placeholder="YYYY-MM-DD" value="{{ values.get('birthday','') }}" autocomplete="bday">

            <label for="address">Address:</label>
            <textarea name="address" id="address" rows="2" autocomplete="street-address">{{ values.get('address','') }}</textarea>

            <label for="note">Notes:</label>
            <textarea name="note" id="note" rows="2">{{ values.get('note','') }}</textarea>
        </div>

        <button type="submit">Generate QR</button>
    </form>

    {% if qr_img %}
    <div id="qr-section">
        <h2>Your QR Code</h2>
        <img src="data:image/png;base64,{{ qr_img }}" alt="vCard QR Code">
        <a href="data:image/png;base64,{{ qr_img }}" download="contact_qr.png">
            <button type="button">Download QR</button>
        </a>
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
flatpickr("#birthday", {
    dateFormat: "Y-m-d",
    allowInput: true
});

const toggleBtn = document.getElementById('toggleOptional');
const optionalFields = document.getElementById('optionalFields');

toggleBtn.addEventListener('click', () => {
    if (optionalFields.style.display === 'none') {
        optionalFields.style.display = 'block';
        toggleBtn.textContent = "Hide Optional Fields ▲";
    } else {
        optionalFields.style.display = 'none';
        toggleBtn.textContent = "Show More Optional Fields ▼";
    }
});

const form = document.getElementById("contactForm");
const submitBtn = document.querySelector("button[type='submit']");
const requiredFields = ["name", "phone"];

function checkFormValidity() {
    let valid = true;
    requiredFields.forEach(id => {
        const input = document.getElementById(id);
        if (!input.value.trim()) valid = false;
    });
    submitBtn.classList.toggle("valid", valid);
}

requiredFields.forEach(id => {
    document.getElementById(id).addEventListener("input", checkFormValidity);
});

checkFormValidity();
</script>

</body>
</html>
